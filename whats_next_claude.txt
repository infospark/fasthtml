## Where We Are

The server-side SSE infrastructure is fully in place. Graph mutations publish
typed events (NodeAdded/EdgeAdded) via pub/sub, and an SSE endpoint streams
them to clients.

### What's been done:

1. **Graph mutation methods are now private** (_add_node, _add_edge, etc.)
   All mutations go through GraphManager.add_node() / add_edge() which
   validate, mutate the graph, and publish events to subscribers.

2. **Event dataclasses created**: NodeAdded(graph_id, node), EdgeAdded(graph_id, edge)
   - GraphEvent = NodeAdded | EdgeAdded (type alias in data_types.py)

3. **Old publish() removed** - replaced by internal _publish(event) that sends
   individual events (no more deep copying entire graphs).

4. **Three-layer SSE architecture** complete:
   - Layer 1: graph_event_to_sse_data() - pure function: GraphEvent -> JSON string
   - Layer 2: graph_sse_stream() - async generator: subscribes to GraphManager, yields SSE-formatted strings
   - Layer 3: SSE route handler in graph_routes.py (GET /graph/events)

5. **E2E tests separated** into tests_e2e/ directory to isolate Playwright's
   event loop from pytest-asyncio unit tests. build.sh and CI updated.

### What's next:

1. **Browser-side JS**: The graph page needs JavaScript that:
   - Opens an EventSource connection to the SSE endpoint
   - Parses incoming JSON events
   - Calls Cytoscape's cy.add() for node_added/edge_added events
   Look at the existing cytoscape script setup in graph_cytoscape_utils.py.

2. **E2E test**: test_graph_page_adds_node_to_existing_graph in tests_e2e/ is
   currently skipped (@pytest.mark.skip). Once the browser-side JS is wired up,
   this test should pass - it adds a node server-side and checks the browser sees it.

3. User changing a node - reflecting user changes via post events back to server? some thought needed here